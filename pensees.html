<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<title>PensÃ©es â€” Archives 2017â€“2021</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<!-- Note: original used Google Fonts link; keeping it for Caveat & Lora -->
<link href="https://fonts.googleapis.com/css2?family=Caveat:wght@500&amp;family=Lora&amp;display=swap" rel="stylesheet"/>
<style>
/* --- Base (kept from original, slightly adapted) --- */
:root{
  --paper-bg: #f3e9dd;
  --paper-ink: #2b1f16;
  --warm-1: rgba(255,213,128,0.95);
  --warm-2: rgba(200,140,90,0.95);
}
body {
  margin: 0;
  font-family: Lora, serif;
  background: url("images/background.jpg") no-repeat center center fixed;
  background-size: cover;
  color: white;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

/* Header + layout kept mostly intact */
header {
  text-align: center;
  background: rgba(180,60,60,0.5);
  border-radius: 12px;
  padding: 20px 40px;
  width: fit-content;
  margin: 40px auto;
}

h1 {
  font-family: 'Caveat', cursive;
  font-size:clamp(32px,5vw,60px);
  margin:0;
  color: rgba(255, 213, 128, 0.9);
  letter-spacing:1px;
}

.sub {
  color: rgba(255, 213, 128, 0.8);
  font-size:15px;
  margin-top:8px;
}

nav.years {
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:10px;
  margin:20px 0 30px;
}

nav.years a {
  text-decoration:none;
  color:#f2f2f2;
  padding:6px 14px;
  border:1px solid rgba(255,255,255,0.2);
  border-radius:20px;
  background: rgba(180,60,60,0.75);
  font-size:14px;
}

section.year {
  width:min(1100px,92%);
  text-align: center;
  margin:30px auto;
  border:1px solid rgba(255,255,255,0.08);
  border-radius:16px;
  box-shadow:0 6px 20px rgba(0,0,0,0.5);
  overflow:hidden;
  background: linear-gradient(180deg, rgba(0,0,0,0.12), rgba(0,0,0,0.18));
}

.months {
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  padding:18px;
}

.month {
  flex:1 1 220px;
  background: rgba(180,80,80,0.70);
  border:1px solid rgba(255,255,255,0.06);
  border-radius:12px;
  padding:10px 12px;
}

.month h2 {
  font-size:17px;
  margin:0 0 10px;
  font-family: 'Caveat', cursive;
  color:#efe7ff;
}

.entries {
  display:flex;
  flex-direction:column;
  gap:6px;
}

.entry {
  background: rgba(180,80,80,0.70);
  padding:8px 10px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.06);
  text-decoration:none;
  color:#f2f2f2;
  font-size:14px;
  transition: background 0.18s, transform 0.12s;
  cursor:pointer;
  display:block;
}

.entry:hover { transform: translateY(-2px); background: rgba(200,100,100,0.78); }

.entry .date {
  font-weight:bold;
  font-size:13px;
  color:#ffb3b3;
}

footer {
  text-align:center;
  color:#b43c3c;
  padding:40px 20px;
  font-size:13px;
}

/* --- Modal: carnet intime style --- */
.modal-backdrop {
  position: fixed;
  inset: 0;
  display:none;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(2px) saturate(0.8);
}

/* The "book" container */
.journal {
  width: min(880px,94%);
  max-height: 88vh;
  background: linear-gradient(180deg, var(--paper-bg), #f0e1cf 60%);
  border-radius: 12px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.7);
  overflow: hidden;
  display:flex;
  flex-direction:column;
  transform-origin: left center;
  transform: scaleX(0);
  transition: transform 420ms cubic-bezier(.2,.9,.25,1);
  border: 1px solid rgba(40,30,20,0.12);
  font-family: Lora, serif;
  color: var(--paper-ink);
}

/* textured paper using SVG data URI (no external images) */
.journal::before{
  content: "";
  position: absolute;
  inset:0;
  pointer-events:none;
  background-image:
   linear-gradient(transparent 0, rgba(0,0,0,0.02) 1px),
   radial-gradient(circle at 20% 30%, rgba(0,0,0,0.02) 0.5px, transparent 1px);
  mix-blend-mode: multiply;
  opacity: 0.7;
}

/* header/banner inside modal */
.journal-header{
  background: linear-gradient(90deg, rgba(220,170,100,0.12), rgba(230,190,120,0.05));
  padding: 14px 18px;
  border-bottom: 1px solid rgba(0,0,0,0.05);
  display:flex;
  align-items:center;
  justify-content:space-between;
}
.journal-title{
  font-family: 'Caveat', cursive;
  font-size:22px;
  color: #7a4b22;
  letter-spacing:1px;
}
.journal-controls{
  display:flex;
  gap:8px;
  align-items:center;
}
.journal-controls button{
  background: transparent;
  border: none;
  font-size:18px;
  cursor:pointer;
  color: #7a4b22;
}

/* content area */
.journal-body{
  padding: 22px 30px;
  overflow:auto;
  line-height:1.7;
  font-size:18px;
  -webkit-overflow-scrolling: touch;
}
.journal-body h1, .journal-body h2, .journal-body h3 {
  font-family: 'Caveat', cursive;
  color: #5b3a25;
}
.journal-body p {
  color: #3b2920;
  margin: 0 0 1em 0;
  font-size:18px;
}
.journal-body a { color: #7a4b22; text-decoration: underline; }

/* Close button */
.journal-close{
  position:absolute;
  right:14px;
  top:12px;
  background: none;
  border: none;
  font-size:22px;
  cursor:pointer;
  color:#7a4b22;
}

/* Opening animation when active */
.modal-backdrop.show { display:flex; }
.journal.open { transform: scaleX(1); transition: transform 420ms cubic-bezier(.2,.9,.25,1); }

/* small page-turn effect using rotateY */
.journal.turning {
  transform-origin: left center;
  animation: pageTurn 420ms ease both;
}
@keyframes pageTurn {
  0% { transform: perspective(800px) rotateY(-88deg) scaleX(0.98); box-shadow: 0 30px 80px rgba(0,0,0,0.6);}
  60% { transform: perspective(800px) rotateY(8deg) scaleX(1.02); }
  100% { transform: perspective(800px) rotateY(0deg) scaleX(1); }
}

/* responsive tweaks */
@media (max-width:600px){
  .journal { width: 96%; }
  .journal-body { padding: 14px 16px; font-size:16px; }
}

/* small utility */
.loading { opacity: 0.6; }
</style>
</head>
<body>
<div class="overlay-dark"></div>
<div class="vhs-glitch"></div><div aria-hidden="true" class="overlay-dark"></div>
<header>
<h1>PensÃ©es</h1>
<div class="sub">Fragments intimes, 2017â€“2021</div>
<nav class="years">
<a href="#y2017">2017</a>
<a href="#y2018">2018</a>
<a href="#y2019">2019</a>
<a href="#y2020">2020</a>
<a href="#y2021">2021</a>
</nav>
</header>

<!-- Modal for displaying markdown entries -->
<div id="modal" class="modal-backdrop" aria-hidden="true" role="dialog" aria-modal="true">
  <article class="journal" role="document" aria-labelledby="journal-title">
    <div class="journal-header">
      <div id="journal-title" class="journal-title">âœ¦ Journal de PensÃ©es âœ¦</div>
      <div class="journal-controls">
        <button id="open-as-page" title="Ouvrir comme page">ðŸ”Ž</button>
      </div>
    </div>
    <button class="journal-close" id="close-modal" aria-label="Fermer">âœ•</button>
    <div id="journal-body" class="journal-body">
      <p style="color:#6b4f3a">Chargementâ€¦</p>
    </div>
  </article>
</div>

<!-- ===== Original content (entries) inserted below (kept intact but with target removed via script) ===== -->
<footer>
  Â©RUST9
</footer>

<!-- Existing scripts from original preserved (overlay/glitch behavior) -->
<script>
(function(){
  const dark = document.querySelector('.overlay-dark');
  function update() {
    const scrollY = window.scrollY || window.pageYOffset;
    const docHeight = Math.max(document.documentElement.scrollHeight, document.body.scrollHeight) - window.innerHeight;
    const progress = docHeight > 0 ? (scrollY / docHeight) : 0;
    const darkOpacity = Math.min(progress * 0.85, 0.85);
    if (dark) dark.style.background = 'rgba(0,0,0,' + darkOpacity + ')';
    const hue = Math.round(progress * 60 - 30);
    const contrast = 1 + progress * 0.6;
    const saturate = 1 + progress * 0.8;
    document.body.style.filter = 'hue-rotate(' + hue + 'deg) contrast(' + contrast + ') saturate(' + saturate + ')';
    let offsetX = 0, offsetY = 0;
    if (progress > 0.7) {
      const intensity = (progress - 0.7) * 60;
      offsetX = (Math.random() - 0.5) * intensity;
      offsetY = (Math.random() - 0.5) * intensity;
    }
    document.body.style.backgroundPosition = offsetX + 'px ' + offsetY + 'px';
  }
  window.addEventListener('scroll', () => { window.requestAnimationFrame(update); }, {passive:true});
  update();
})();
</script>
<script>
(function(){
  const overlay = document.querySelector('.overlay-dark');
  const vhs = document.querySelector('.vhs-glitch');
  const body = document.body;
  let animLoop=null, glitchMode='calm', vhsInterval=null;
  function getProgress(){
    const y=window.scrollY||pageYOffset;
    const h=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight)-window.innerHeight;
    return h>0?Math.min(1,Math.max(0,y/h)):0;
  }
  function applyOverlay(p){ const o=Math.min(p*0.85,0.85); overlay.style.background=`rgba(0,0,0,${o})`; }
  function startLoop(){ if(animLoop) return; function loop(){ const p=getProgress(); applyOverlay(p); if(glitchMode==='soft'){ const ox=(Math.random()-0.5)*10; const oy=(Math.random()-0.5)*5; body.style.backgroundPosition=`${ox}px ${oy}px`; } else if(glitchMode==='violent'){ const ox=(Math.random()-0.5)*60; const oy=(Math.random()-0.5)*60; body.style.backgroundPosition=`${ox}px ${oy}px`; } animLoop=requestAnimationFrame(loop); } animLoop=requestAnimationFrame(loop); }
  function stopLoop(){ if(animLoop){cancelAnimationFrame(animLoop);animLoop=null;} body.style.backgroundPosition=''; }
  function spawnBand(){ const b=document.createElement('div'); b.className='vhs-band'; b.style.top=Math.floor(Math.random()*100)+'%'; b.style.height=(6+Math.random()*36)+'px'; vhs.appendChild(b); requestAnimationFrame(()=>{b.style.opacity='1';b.style.transform='translateX(15%)';}); setTimeout(()=>{b.style.opacity='0';b.style.transform='translateX(-10%)';setTimeout(()=>{try{vhs.removeChild(b);}catch(e){}},200);},200+Math.random()*500); }
  function startBands(){ if(vhsInterval) return; vhs.style.opacity='1'; vhsInterval=setInterval(()=>{spawnBand();},300); }
  function stopBands(){ if(vhsInterval){clearInterval(vhsInterval);vhsInterval=null;} vhs.style.opacity='0'; }
  function handle(){ const p=getProgress(); if(p<0.35){ if(glitchMode!=='calm'){ glitchMode='calm'; stopLoop(); stopBands(); }} else if(p<0.75){ if(glitchMode!=='soft'){ glitchMode='soft'; startLoop(); stopBands(); }} else { if(glitchMode!=='violent'){ glitchMode='violent'; startLoop(); startBands(); }} }
  window.addEventListener('scroll',()=>{requestAnimationFrame(handle);},{passive:true});
  handle();
})();
</script>

<!-- ===== Inline lightweight markdown parser named `marked` (API: marked.parse(md)) ===== -->
<script>
/*
  Lightweight markdown-to-HTML parser to render basic markdown inside the modal.
  It exposes marked.parse(text) so your existing code expecting marked.js will work.
  Supports headings, paragraphs, bold/italic, links, code blocks (```), inline code, lists.
*/
window.marked = (function(){
  function escapeHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
  function parseInline(s){
    // code spans
    s = s.replace(/`([^`]+)`/g, function(_,c){ return '<code>'+escapeHtml(c)+'</code>'; });
    // bold **text** or __text__
    s = s.replace(/\*\*([^*]+)\*\*/g,'<strong>$1</strong>').replace(/__([^_]+)__/g,'<strong>$1</strong>');
    // italics *text* or _text_
    s = s.replace(/(^|[^*])\*([^*][^*]*)\*([^*]|$)/g,'$1<em>$2</em>$3');
    s = s.replace(/(^|[^_])_([^_][^_]*)_([^_]|$)/g,'$1<em>$2</em>$3');
    // links [text](url)
    s = s.replace(/\[([^\]]+)\]\(([^)]+)\)/g, function(_,t,u){ return '<a href="'+u+'">'+t+'</a>'; });
    return s;
  }
  function parse(md){
    if(!md) return '';
    // Normalize line endings
    md = md.replace(/\r\n?/g,'\n');
    // Handle code fences ```lang\n...\n```
    md = md.replace(/\n```[^\n]*\n([\s\S]*?)\n```/g, function(_,code){ return '\n<pre><code>'+escapeHtml(code)+'</code></pre>\n'; });
    var lines = md.split('\n');
    var out = [], i=0;
    var inList=false, listType='ul';
    for(; i<lines.length; i++){
      var line = lines[i];
      // headings
      var h = line.match(/^(#{1,6})\s+(.*)$/);
      if(h){ out.push('<h'+h[1].length+'>'+parseInline(escapeHtml(h[2]))+'</h'+h[1].length+'>'); continue; }
      // unordered list
      if(/^\s*[-*]\s+/.test(line)){
        if(!inList){ inList=true; listType='ul'; out.push('<ul>'); }
        out.push('<li>'+parseInline(escapeHtml(line.replace(/^\s*[-*]\s+/,'')))+'</li>');
        continue;
      } else if(/^\s*\d+\.\s+/.test(line)){
        if(!inList){ inList=true; listType='ol'; out.push('<ol>'); }
        out.push('<li>'+parseInline(escapeHtml(line.replace(/^\s*\d+\.\s+/,'')))+'</li>');
        continue;
      } else {
        if(inList){ out.push(listType==='ul'?'</ul>':'</ol>'); inList=false; }
      }
      if(/^\s*$/.test(line)){ out.push(''); continue; }
      // paragraph (collect consecutive non-empty lines)
      var para = line;
      while(i+1<lines.length && lines[i+1].trim() !== '' && !/^(#{1,6})\s+/.test(lines[i+1]) && !/^\s*[-*\d]/.test(lines[i+1]) && !/^\s*```/.test(lines[i+1])){
        para += ' ' + lines[++i].trim();
      }
      out.push('<p>'+parseInline(escapeHtml(para.trim()))+'</p>');
    }
    if(inList) out.push(listType==='ul'?'</ul>':'</ol>');
    return out.join('\n');
  }
  return { parse: parse };
})();
</script>

<!-- ===== Modal logic: remove target="_blank", fetch MD and render into modal ===== -->
<script>
(function(){
  const modal = document.getElementById('modal');
  const journal = modal.querySelector('.journal');
  const body = document.getElementById('journal-body');
  const closeBtn = document.getElementById('close-modal');
  const openAsPageBtn = document.getElementById('open-as-page');

  function openModal(title, htmlContent){
    document.getElementById('journal-title').textContent = 'âœ¦ Journal de PensÃ©es âœ¦';
    body.innerHTML = htmlContent;
    modal.classList.add('show');
    // trigger page-turn animation
    journal.classList.remove('open');
    void journal.offsetWidth;
    journal.classList.add('turning');
    setTimeout(()=>{ journal.classList.remove('turning'); journal.classList.add('open'); }, 420);
    modal.setAttribute('aria-hidden','false');
    // focus for accessibility
    closeBtn.focus();
  }
  function closeModal(){
    journal.classList.remove('open');
    journal.classList.add('turning');
    // reverse animation: quickly shrink
    journal.style.transformOrigin = 'right center';
    journal.style.transition = 'transform 320ms cubic-bezier(.2,.9,.25,1)';
    journal.style.transform = 'perspective(800px) rotateY(88deg) scaleX(0.98)';
    setTimeout(()=>{
      journal.style.transform = '';
      journal.style.transition = '';
      journal.style.transformOrigin = 'left center';
      modal.classList.remove('show');
      modal.setAttribute('aria-hidden','true');
    },320);
  }

  closeBtn.addEventListener('click', closeModal);
  modal.addEventListener('click', function(e){
    if(e.target === modal) closeModal();
  });
  window.addEventListener('keydown', function(e){
    if(e.key === 'Escape' && modal.classList.contains('show')) closeModal();
  });

  // when user clicks "open as page" open underlying md url in same tab
  openAsPageBtn.addEventListener('click', function(){
    const url = openAsPageBtn.dataset.url;
    if(url) window.location.href = url;
  });

  // Find all .entry anchors and modify behavior
  function initEntries(){
    const entries = document.querySelectorAll('a.entry');
    entries.forEach(a=>{
      // remove target attribute if present
      if(a.hasAttribute('target')) a.removeAttribute('target');
      // store href on the open-as-page button when opening
      a.addEventListener('click', function(ev){
        ev.preventDefault();
        const href = a.getAttribute('href');
        if(!href) return;
        body.innerHTML = '<p style="color:#6b4f3a">Chargementâ€¦</p>';
        openAsPageBtn.dataset.url = href;
        // fetch the .md file via fetch
        fetch(href).then(res=>{
          if(!res.ok) throw new Error('Erreur de lecture du fichier: '+res.status);
          return res.text();
        }).then(md=>{
          // render markdown to HTML using marked.parse
          const html = marked.parse(md);
          openModal('', html);
        }).catch(err=>{
          openModal('', '<p style="color:#6b4f3a">Impossible de charger le fichier.<br>'+escapeHtml(err.message)+'</p>');
        });
      });
      // make keyboard accessible
      a.addEventListener('keypress', function(e){
        if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); a.click(); }
      });
      // make sure it looks clickable for non-anchor treatments
      a.setAttribute('role','button');
      a.setAttribute('tabindex','0');
    });
  }

  // small helper
  function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  document.addEventListener('DOMContentLoaded', initEntries);
  // also init now in case DOM already parsed
  initEntries();
})();
</script>

</body>
</html>
