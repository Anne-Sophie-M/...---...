<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Piège Simplifié</title>
<style>
body, html { margin:0; padding:0; height:100%; width:100%; background:black; overflow:hidden; cursor:pointer;}
#background { position:absolute; top:0; left:0; width:100%; height:100%; background-size:cover; background-position:center;}
#grain {
  position:absolute; top:0; left:0; width:100%; height:100%;
  background: repeating-linear-gradient(0deg, rgba(255,255,255,0.03), rgba(255,255,255,0.03) 1px, transparent 1px, transparent 2px);
  mix-blend-mode:overlay; opacity:0.3; animation:grainMove 0.8s steps(8) infinite; pointer-events:none;
}
@keyframes grainMove {0%{transform:translate(0,0);}20%{transform:translate(-5px,3px);}40%{transform:translate(4px,-3px);}60%{transform:translate(-3px,2px);}80%{transform:translate(3px,-2px);}100%{transform:translate(0,0);}}
#dust {
  position:absolute; top:0; left:0; width:100%; height:100%;
  background: radial-gradient(circle, rgba(255,255,255,0.05) 1px, transparent 1px);
  background-size:10px 10px; mix-blend-mode:screen; opacity:0.2; animation:dustMove 5s linear infinite; pointer-events:none;
}
@keyframes dustMove {0%{transform:translate(0,0);}100%{transform:translate(-200px,200px);}}
#popup { position:fixed; top:0; left:0; width:100%; height:100%; background:black; display:flex; justify-content:center; align-items:center; z-index:10; display:none; cursor:pointer;}
#popupContent { background:black; border:3px solid red; padding:40px; color:red; font-size:2.5em; text-align:center; text-transform:uppercase; text-shadow:0 0 15px red,0 0 30px black;}
@keyframes glitch1 {0%{transform:translate(0,0);}20%{transform:translate(-1px,0);}40%{transform:translate(1px,0);}60%{transform:translate(-1px,0);}80%{transform:translate(1px,0);}100%{transform:translate(0,0);}}
@keyframes glitch2 {0%{transform:translate(0,0);}20%{transform:translate(-2px,1px);}40%{transform:translate(2px,-1px);}60%{transform:translate(-2px,1px);}80%{transform:translate(2px,-1px);}100%{transform:translate(0,0);}}
@keyframes glitch3 {0%{transform:translate(0,0);}20%{transform:translate(-4px,2px);}40%{transform:translate(4px,-2px);}60%{transform:translate(-4px,2px);}80%{transform:translate(4px,-2px);}100%{transform:translate(0,0);}}
</style>
</head>
<body>

<div id="background"></div>
<div id="grain"></div>
<div id="dust"></div>
<div id="popup"><div id="popupContent"></div></div>

<audio id="audio" loop></audio>

<script>
// ----- Scénario final simplifié -----
const etapes = [
  { img:"https://picsum.photos/id/1011/1920/1080", popup:"Je ne peux pas.. c'est bloqué !", audio:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" },
  { img:"https://picsum.photos/id/1012/1920/1080", popup:"J'essaye !", audio:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" },
  { img:"https://picsum.photos/id/1015/1920/1080", popup:"Je n'y arrive pas !!!", audio:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" },
  { img:"https://picsum.photos/id/1016/1920/1080", popup:"C'est trop tard...", audio:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3" },
  { img:"https://picsum.photos/id/1018/1920/1080", popup:"...---...", audio:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3" }
];

let index = 0;
const bgEl = document.getElementById("background");
const popup = document.getElementById("popup");
const popupContent = document.getElementById("popupContent");
const audio = document.getElementById("audio");
let firstClickDone = false;

bgEl.style.backgroundImage = `url(${etapes[0].img})`;

// ----- Affichage popup avec glitch -----
function showPopup(step){
  audio.src = step.audio;
  audio.play().catch(()=>{});
  popupContent.textContent = step.popup;
  popup.style.display = "flex";
  let glitchLevel = Math.min(index+1,3);
  popupContent.style.animation = `glitch${glitchLevel} 0.15s infinite`;
}

// ----- Étape suivante (image) -----
function nextStep(){
  index++;
  if(index<etapes.length){
    bgEl.style.backgroundImage = `url(${etapes[index].img})`;
  } else {
    // dernière image → retour navigateur normal
    window.onpopstate = null;
  }
}

// ----- Premier clic image ----- 
bgEl.addEventListener("click", ()=>{
  if(!firstClickDone){
    firstClickDone = true;
    audio.src = etapes[0].audio;
    audio.play().catch(()=>{});
  }
});

// ----- Clic sur popup ----- 
popup.addEventListener("click", ()=>{
  popup.style.display="none";
  nextStep();
});

// ----- Bloquer le retour navigateur sur pop-ups -----

// On pousse plusieurs états dès le départ pour bloquer le retour
for(let i=0; i<5; i++){
  history.pushState({step:0}, "");
}

window.onpopstate = function(e){
  // Si on est sur un pop-up
  if(index < etapes.length){
    showPopup(etapes[index]);
    // Repousser immédiatement un nouvel état pour rester bloqué
    setTimeout(()=>{ history.pushState({step:index},""); }, 0);
  } else {
    // Dernière étape → retour navigateur normal
    window.onpopstate = null;
  }
};
</script>
</body>
</html>
