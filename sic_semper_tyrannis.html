<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Test Set9 Special</title>
<style>
html,body {margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:black;}
canvas {position:fixed; top:0; left:0; width:100%; height:100%; object-fit:cover; z-index:-1;}
#set9special {position:fixed; top:0; left:0; width:100%; height:100%; z-index:1000; display:none; cursor:pointer;}
#startButton {position:fixed; top:0; left:0; width:100%; height:100%; background:transparent; border:none; cursor:pointer; z-index:10;}
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<img id="set9special" src="images/set9special.jpg">
<button id="startButton">Start</button>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const sets = [
    {images:["images/set1trans1.jpg","images/set1final.jpg"], audio:"audio/audio1.mp3"},
    {images:["images/set9trans1.jpg","images/set9final.jpg"], audio:"audio/audio9.mp3"}
];

const chosenSet = sets[1]; // Test set9
const transitions = chosenSet.images;

let loadedImages = [];
async function preloadImages(sources){
    const promises = sources.map(src => new Promise(resolve=>{
        const img = new Image();
        img.src = src;
        img.onload = ()=>resolve(img);
        img.onerror = ()=>resolve(img);
        loadedImages.push(img);
    }));
    await Promise.all(promises);
}

let clickCount = 0;
const maxClicks = 2;
let set9SpecialShown = false;

document.body.addEventListener('click',()=>{
    clickCount++;
    if(chosenSet === sets[1] && clickCount === 1 && !set9SpecialShown){
        set9SpecialShown = true;
        document.getElementById('set9special').style.display='block';
    }
});

async function draw(){
    await preloadImages(transitions);
    function frame(){
        requestAnimationFrame(frame);

        if(set9SpecialShown) return; // overlay visible, cache tout

        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(loadedImages[0],0,0,canvas.width,canvas.height);
    }
    frame();
}
draw();
</script>
</body>
</html>
