<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Test Set9 Special</title>
<style>
html,body {
  margin:0; padding:0; width:100%; height:100%;
  background:black; overflow:hidden;
}
canvas {
  position:fixed; top:0; left:0; width:100%; height:100%;
}
#special {
  position:fixed; top:0; left:0; width:100%; height:100%;
  display:none; z-index:10;
}
#startButton {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:transparent; border:none; cursor:pointer;
  z-index:20;
}
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<img id="special" src="images/set9special.jpg">
<audio id="audio" src="audio/audio9.mp3" loop></audio>
<button id="startButton"></button>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const images = [
  "images/set9trans1.jpg",
  "images/set9trans2.jpg",
  "images/set9trans3.jpg",
  "images/set9trans4.jpg",
  "images/set9final.jpg"
];

let loaded = [];
let clickCount = 0;
let specialVisible = false;

function preload(srcs){
  return Promise.all(srcs.map(src=>{
    return new Promise(res=>{
      const img=new Image();
      img.onload=()=>res(img);
      img.src=src;
    });
  }));
}

function morph(img1,img2,alpha){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.globalAlpha=1-alpha;
  ctx.drawImage(img1,0,0,canvas.width,canvas.height);
  ctx.globalAlpha=alpha;
  ctx.drawImage(img2,0,0,canvas.width,canvas.height);
  ctx.globalAlpha=1;
}

function draw(){
  if(specialVisible) return; // stop rendering once special is visible
  requestAnimationFrame(draw);

  let index=Math.min(Math.floor(clickCount/10),images.length-2);
  let alpha=(clickCount%10)/10;
  morph(loaded[index],loaded[index+1],alpha);
}

document.getElementById('startButton').addEventListener('click',()=>{
  document.getElementById('startButton').style.display="none";
  document.getElementById('audio').play();
  draw();
});

document.body.addEventListener('click',()=>{
  if(specialVisible) return;
  clickCount++;
  if(clickCount===46){
    // Stop tout et affiche image spÃ©ciale
    document.getElementById('audio').pause();
    document.body.style.filter=""; // reset filtres
    document.getElementById('special').style.display="block";
    specialVisible=true;
  }
});

preload(images).then(imgs=>{
  loaded=imgs;
  ctx.drawImage(loaded[0],0,0,canvas.width,canvas.height);
});
</script>
</body>
</html>
